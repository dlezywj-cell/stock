<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- è§†å£è®¾ç½® -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="è‚¡ç¥¨å¤ç›˜">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2422/2422269.png">

    <title>è‚¡ç¥¨ä¼°å€¼å¤ç›˜ç³»ç»Ÿ (æ•°æ®é¢„ç½®ç‰ˆ)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 10px; margin: 0; background-color: #f4f6f9; font-size: 14px; color: #333; -webkit-tap-highlight-color: transparent; }
        
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 5px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h2 { margin: 0; font-size: 16px; border-left: 4px solid #007bff; padding-left: 8px; color: #2c3e50; }

        .control-bar { 
            margin-bottom: 10px; display: flex; gap: 8px; align-items: center; 
            background: #fff; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            flex-wrap: wrap; 
        }
        .divider { border-left: 1px solid #eee; height: 20px; margin: 0 2px; }
        
        #input-container { display: none; } 
        #input-panel { padding: 15px; border-top: 3px solid #007bff; }
        .input-row { display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end; margin-bottom: 15px; }
        
        /* æ‰‹æœºç«¯é€‚é… */
        @media (max-width: 600px) {
            .input-row { flex-direction: column; align-items: stretch; }
            .group-box { flex-direction: column; }
            .group-box > div { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
            .group-box input { width: 60% !important; }
            .control-bar { justify-content: space-between; }
            .btn-toggle { width: 100%; text-align: center; padding: 10px; }
            .btn-view { padding: 6px 8px; }
        }

        .group-box { border: 1px solid #e9ecef; padding: 10px; border-radius: 6px; background: #f8f9fa; display: flex; gap: 10px; flex-wrap: wrap; }
        .group-title { font-weight: bold; color: #555; margin-right: 5px; font-size: 13px; width: 100%; border-bottom: 1px solid #ddd; margin-bottom: 5px; padding-bottom: 3px; }
        
        label { font-size: 12px; color: #666; font-weight: 500; }
        input { padding: 8px; border: 1px solid #ced4da; border-radius: 4px; width: 90px; transition: border-color 0.2s; font-size: 14px; }
        
        button { padding: 8px 12px; cursor: pointer; border: none; border-radius: 6px; font-weight: 600; font-size: 13px; display: inline-flex; align-items: center; justify-content: center; gap: 4px; touch-action: manipulation; }
        button:active { opacity: 0.7; transform: scale(0.98); }

        .btn-search { background-color: #17a2b8; color: white; }
        .btn-add { background-color: #28a745; color: white; }
        .btn-edit { background-color: #ffc107; color: #333; }
        .btn-log { background-color: #6f42c1; color: white; }
        .btn-delete { background-color: #dc3545; color: white; }
        .btn-sync { background-color: #007bff; color: white; }
        .btn-import { background-color: #17a2b8; color: white; }
        .btn-control { background-color: #6c757d; color: white; }
        .btn-toggle { background-color: #f8f9fa; border: 1px solid #ccc; color: #333; }
        .btn-find { background-color: #fd7e14; color: white; }
        
        .btn-view { background-color: #e9ecef; color: #adb5bd; border: 1px solid transparent; }
        .btn-view.active { background-color: #007bff; color: white; }
        .btn-compare { background-color: #6f42c1; color: white; }
        .btn-compare.active { background-color: #4a2c85; }
        .btn-reset-all { background-color: #6c757d; color: white; }
        .btn-confirm-del { background-color: #dc3545; color: white; font-size: 14px; padding: 10px 30px; }
        .btn-cancel { background-color: #6c757d; color: white; font-size: 14px; padding: 10px 30px; }

        #result { overflow-x: auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e9ecef; -webkit-overflow-scrolling: touch; min-height: 300px; }
        table { border-collapse: collapse; width: 100%; min-width: 1000px; } 
        th, td { padding: 12px 8px; text-align: center; border: 1px solid #ebebeb; white-space: nowrap; font-size: 13px; }
        th { background-color: #f1f3f5; color: #495057; font-weight: 700; position: sticky; top: 0; z-index: 10; }
        tbody tr:nth-child(even) { background-color: #f8f9fa; } 
        
        .col-hidden { display: none !important; }
        .tag-badge { display: inline-block; background: #e7f5ff; color: #007bff; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin: 1px; border: 1px solid #d0ebff; }
        .th-basic { border-top: 3px solid #6c757d; }
        .th-pe { border-top: 3px solid #28a745; background-color: #f3fdf6; }
        .th-ps { border-top: 3px solid #fd7e14; background-color: #fff8f3; }
        
        .filter-icon { font-size: 14px; color: #adb5bd; padding: 4px; margin-left: 2px; }
        .filter-active { color: #dc3545 !important; font-weight: bold; }

        #filter-menu { display: none; position: absolute; background: white; border: 1px solid #ccc; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; z-index: 3000; min-width: 220px; }
        #filter-menu h4 { margin: 0 0 10px 0; font-size: 14px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .filter-row { display: flex; gap: 5px; margin-bottom: 10px; align-items: center; }
        .filter-row select, .filter-row input { height: 30px; box-sizing: border-box; }
        .filter-actions { display: flex; justify-content: flex-end; gap: 10px; }
        
        .row-checkbox { transform: scale(1.3); }
        .row-selected { background-color: #e8f0fe !important; }
        .row-highlight { animation: highlightFade 2.5s ease-out forwards; }
        @keyframes highlightFade { 0% { background-color: #ffeb3b; } 100% { background-color: transparent; } }
        
        #status-msg { font-size: 12px; color: #007bff; margin-right: 10px; display: block; margin-top: 5px; }
        .sort-icon { font-size: 10px; margin-left: 4px; color: #adb5bd; }
        .sort-active { color: #007bff; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px); justify-content: center; align-items: center; }
        .modal-content { background-color: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 15px 40px rgba(0,0,0,0.3); position: relative; max-height: 80vh; overflow-y: auto; }
        .close-btn { position: absolute; top: 15px; right: 15px; font-size: 28px; color: #aaa; padding: 5px; }
        .log-entry { border-bottom: 1px solid #eee; padding: 12px 0; font-size: 13px; color: #444; }
        .log-time { color: #999; font-size: 12px; margin-bottom: 4px; }
        .log-change { color: #2c3e50; font-weight: 600; }
        .log-note { display: block; margin-top: 6px; color: #555; background: #fff3cd; padding: 6px 10px; border-radius: 4px; border-left: 3px solid #ffc107; }
    </style>
</head>
<body>

    <div class="header-bar">
        <h2>ğŸš€ è‚¡ç¥¨å¤ç›˜</h2>
        <div>
            <span id="status-msg"></span>
            <button class="btn-sync" onclick="exportData()">ğŸ“¤</button>
            <button class="btn-import" onclick="importData()">ğŸ“¥</button>
            <span style="border-left:1px solid #ccc; margin:0 5px; height:15px; display:inline-block; vertical-align:middle;"></span>
            <button class="btn-control" onclick="startRealtime()">â–¶</button>
            <button class="btn-control" onclick="stopRealtime()">â¹</button>
        </div>
    </div>

    <div class="control-bar">
        <button class="btn-toggle" onclick="toggleInputPanel()" id="toggle-btn" style="flex-grow:1;">â• å½•å…¥/ç®¡ç†</button>
        
        <div style="display:flex; gap:5px; align-items:center;">
            <input type="text" id="findInput" placeholder="æœä»£ç ..." style="width: 80px;" onkeydown="if(event.keyCode==13) findInList()">
            <button class="btn-find" onclick="findInList()">Go</button>
        </div>
    </div>
    
    <div class="control-bar" style="justify-content: space-between;">
        <div style="display:flex; gap:5px; align-items:center;">
            <span style="color:#666;font-size:12px;">æ˜¾ç¤º:</span>
            <button class="btn-view active" id="btn-toggle-code" onclick="toggleColumn('code')">ä»£ç </button>
            <button class="btn-view active" id="btn-toggle-tags" onclick="toggleColumn('tags')">å±æ€§</button>
        </div>
        <div style="display:flex; gap:5px;">
            <button class="btn-reset-all" onclick="clearAllFilters()">ğŸŒªï¸</button>
            <button class="btn-compare" id="btn-compare" onclick="toggleShowSelected()">ğŸ“Š (0)</button>
        </div>
    </div>

    <!-- å½•å…¥é¢æ¿ -->
    <div id="input-container">
        <div id="input-panel">
            <input type="hidden" id="editCode" value="">
            <div class="input-row">
                <div class="group-box">
                    <div style="width:100%"><span class="group-title">åŸºç¡€ä¿¡æ¯</span></div>
                    <div><label>åç§°</label><div style="display:flex;gap:5px;flex-grow:1"><input type="text" id="inName" style="width:100%"><button class="btn-search" onclick="searchStockCode()">ğŸ”</button></div></div>
                    <div><label>ä»£ç </label><input type="text" id="inCode" readonly></div>
                    <div style="width:100%"><label>å±æ€§</label><input type="text" id="inTags" placeholder="ç©ºæ ¼åˆ†éš”" style="width:100%"></div>
                    <div style="width:100%"><label>å¤‡æ³¨</label><input type="text" id="inNote" placeholder="æ—¥å¿—å¤‡æ³¨" style="width:100%"></div>
                </div>
            </div>
            <div class="input-row">
                <div class="group-box" style="border-left: 4px solid #28a745;">
                    <div style="width:100%"><span class="group-title" style="color:#28a745">â‘  PE ä¼°å€¼</span></div>
                    <div><label>å‡€åˆ©(äº¿)</label><input type="number" id="inProfit" step="0.1"></div>
                    <div><label>PEä¸‹é™</label><input type="number" id="inLowPE"></div>
                    <div><label>PEä¸Šé™</label><input type="number" id="inHighPE"></div>
                </div>
                <div class="group-box" style="border-left: 4px solid #fd7e14;">
                    <div style="width:100%"><span class="group-title" style="color:#fd7e14">â‘¡ PS ä¼°å€¼</span></div>
                    <div><label>è¥æ”¶(äº¿)</label><input type="number" id="inRevenue" step="0.1"></div>
                    <div><label>PSä¸‹é™</label><input type="number" id="inLowPS" step="0.1"></div>
                    <div><label>PSä¸Šé™</label><input type="number" id="inHighPS" step="0.1"></div>
                </div>
            </div>
            <div style="text-align:center; margin-top:10px;">
                <button class="btn-add" onclick="saveStock()" id="btn-save-text" style="width:60%; padding:10px;">ğŸ’¾ ä¿å­˜è‚¡ç¥¨æ•°æ®</button>
                <button onclick="clearInput()" style="padding:10px;">é‡ç½®</button>
            </div>
        </div>
    </div>

    <div id="result"></div>

    <!-- ç­›é€‰èœå• -->
    <div id="filter-menu">
        <h4 id="filter-title">ç­›é€‰æ¡ä»¶</h4>
        <div class="filter-row" id="filter-row-numeric">
            <select id="filter-op"><option value=">">></option><option value="<"><</option><option value=">=">â‰¥</option><option value="<=">â‰¤</option><option value="=">=</option></select>
            <input type="number" id="filter-val" placeholder="æ•°å€¼">
        </div>
        <div class="filter-row" id="filter-row-text" style="display:none;">
            <input type="text" id="filter-text-val" placeholder="å†…å®¹...">
        </div>
        <div class="filter-actions"><button class="btn-cancel" onclick="clearCurrentFilter()">æ¸…ç©º</button><button class="btn-add" onclick="confirmFilter()">ç¡®å®š</button></div>
        <input type="hidden" id="filter-col-key">
    </div>

    <!-- å¼¹çª— -->
    <div id="log-modal" class="modal"><div class="modal-content"><span class="close-btn" onclick="closeLogModal()">&times;</span><h3 id="modal-title" style="margin-top:0;">æ“ä½œæ—¥å¿—</h3><div id="modal-body"></div></div></div>
    <div id="delete-modal" class="modal"><div class="modal-content" style="text-align: center; padding-top:30px;"><h3>âš ï¸ ç¡®è®¤åˆ é™¤ï¼Ÿ</h3><p id="delete-msg" style="margin-bottom:30px;">...</p><div><button class="btn-confirm-del" onclick="confirmDeleteAction()">ç¡®å®šåˆ é™¤</button><button class="btn-cancel" onclick="closeDeleteModal()">å–æ¶ˆ</button></div></div></div>
    <div id="import-modal" class="modal"><div class="modal-content"><span class="close-btn" onclick="closeImportModal()">&times;</span><h3>ğŸ“¥ å¯¼å…¥æ•°æ®</h3><textarea id="import-area" style="width:100%; height:150px; font-size:12px;" placeholder="åœ¨æ­¤ç²˜è´´..."></textarea><div style="margin-top:15px; text-align:right;"><button class="btn-sync" onclick="execImport()">åˆå¹¶å¯¼å…¥</button></div></div></div>

    <script>
        // â˜…â˜…â˜… é¢„ç½®æ•°æ® (å¦‚æœæœ¬åœ°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™åŠ è½½è¿™äº›æ•°æ®) â˜…â˜…â˜…
        const PRELOADED_DATA = [{"code":"01810.HK","name":"å°ç±³é›†å›¢-W","tags":"æ±½è½¦ æ¸¯è‚¡ æ¶ˆè´¹ç”µå­","profit":520,"lowPE":30,"highPE":40,"revenue":5700,"lowPS":1.5,"highPS":3,"logs":[{"date":"2025/11/20 17:12:48","content":"å±æ€§:â†’æ±½è½¦ æ¸¯è‚¡ æ¶ˆè´¹ç”µå­","note":""},{"date":"2025/11/20 09:58:08","content":"å‡€åˆ©: 680â520, è¥æ”¶: 6900â5700","note":"ä¸‰å­£æŠ¥åè°ƒæ•´"}]},{"code":"09896.HK","name":"ååˆ›ä¼˜å“","tags":"æ¶ˆè´¹","profit":36,"lowPE":15,"highPE":25,"revenue":230,"lowPS":2,"highPS":4,"logs":[{"date":"2025/11/20 17:45:54","content":"å±æ€§:â†’æ¶ˆè´¹","note":""}]},{"code":"002602.SZ","name":"ä¸–çºªåé€š","tags":"æ¸¸æˆ","profit":55,"lowPE":20,"highPE":40,"revenue":490,"lowPS":2.5,"highPS":3.5,"logs":[{"date":"2025/11/20 20:54:45","content":"å±æ€§:â†’æ¸¸æˆ","note":""},{"date":"2025/11/20 11:05:22","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"02020.HK","name":"å®‰è¸ä½“è‚²","tags":"æ¶ˆè´¹","profit":145,"lowPE":18.5,"highPE":25,"revenue":860,"lowPS":3,"highPS":4,"logs":[{"date":"2025/11/20 20:54:56","content":"å±æ€§:â†’æ¶ˆè´¹","note":""},{"date":"2025/11/20 11:20:01","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300502.SZ","name":"æ–°æ˜“ç››","tags":"AI å…‰æ¨¡å—","profit":100,"lowPE":30,"highPE":50,"revenue":250,"lowPS":10,"highPS":16,"logs":[{"date":"2025/11/20 20:55:12","content":"å±æ€§:â†’AI å…‰æ¨¡å—","note":""},{"date":"2025/11/20 11:20:55","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002484.SZ","name":"æ±Ÿæµ·è‚¡ä»½","tags":"AI","profit":8,"lowPE":27,"highPE":45,"revenue":57,"lowPS":3.5,"highPS":6,"logs":[{"date":"2025/11/20 20:55:25","content":"å±æ€§:â†’AI","note":""},{"date":"2025/11/20 11:21:40","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002222.SZ","name":"ç¦æ™¶ç§‘æŠ€","profit":2.9,"lowPE":57,"highPE":90,"revenue":11,"lowPS":15,"highPS":27,"logs":[{"date":"2025/11/20 11:22:49","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"09985.HK","name":"å«é¾™ç¾å‘³","tags":"æ¶ˆè´¹","profit":15.5,"lowPE":17,"highPE":25,"revenue":82,"lowPS":2.7,"highPS":4.5,"logs":[{"date":"2025/11/20 20:55:39","content":"å±æ€§:â†’æ¶ˆè´¹","note":""},{"date":"2025/11/20 11:24:03","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002384.SZ","name":"ä¸œå±±ç²¾å¯†","tags":"æ¶ˆè´¹ç”µå­ å…‰æ¨¡å— PCB AI","profit":60,"lowPE":20,"highPE":40,"revenue":0,"lowPS":0,"highPS":0,"logs":[{"date":"2025/11/20 17:37:59","content":"å±æ€§:â†’æ¶ˆè´¹ç”µå­ å…‰æ¨¡å— PCB AI","note":""},{"date":"2025/11/20 11:25:13","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300866.SZ","name":"å®‰å…‹åˆ›æ–°","tags":"å‡ºå£","profit":26,"lowPE":20,"highPE":30,"revenue":315,"lowPS":2,"highPS":2.5,"logs":[{"date":"2025/11/20 20:56:36","content":"å±æ€§:â†’å‡ºå£","note":""},{"date":"2025/11/20 11:26:14","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"301061.SZ","name":"åŒ å¿ƒå®¶å±…","tags":"å‡ºå£","profit":8.9,"lowPE":20,"highPE":30,"revenue":34,"lowPS":5,"highPS":8,"logs":[{"date":"2025/11/20 21:00:41","content":"å±æ€§:â†’å‡ºå£","note":""},{"date":"2025/11/20 11:27:25","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002558.SZ","name":"å·¨äººç½‘ç»œ","tags":"æ¸¸æˆ","profit":24,"lowPE":20,"highPE":40,"revenue":50,"lowPS":8.5,"highPS":16,"logs":[{"date":"2025/11/20 20:57:01","content":"å±æ€§:â†’æ¸¸æˆ","note":""},{"date":"2025/11/20 11:28:26","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"600563.SH","name":"æ³•æ‹‰ç”µå­","tags":"å…ƒä»¶","profit":13,"lowPE":17.5,"highPE":27,"revenue":58,"lowPS":4,"highPS":6,"logs":[{"date":"2025/11/20 20:56:00","content":"å±æ€§:â†’å…ƒä»¶","note":""},{"date":"2025/11/20 11:29:35","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603596.SH","name":"ä¼¯ç‰¹åˆ©","tags":"æ±½è½¦é›¶éƒ¨ä»¶","profit":14.2,"lowPE":19,"highPE":27,"revenue":124,"lowPS":2.25,"highPS":3,"logs":[{"date":"2025/11/20 20:57:24","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶","note":""},{"date":"2025/11/20 11:30:38","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"301029.SZ","name":"æ€¡åˆè¾¾","profit":5.6,"lowPE":28,"highPE":40,"revenue":30,"lowPS":5,"highPS":7,"logs":[{"date":"2025/11/20 11:31:28","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688052.SH","name":"çº³èŠ¯å¾®","tags":"åŠå¯¼ä½“ æ¨¡æ‹ŸèŠ¯ç‰‡","profit":0,"lowPE":0,"highPE":0,"revenue":30,"lowPS":8.5,"highPS":9.5,"logs":[{"date":"2025/11/20 21:11:49","content":"å±æ€§:â†’åŠå¯¼ä½“ æ¨¡æ‹ŸèŠ¯ç‰‡","note":""},{"date":"2025/11/20 11:32:23","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"689009.SH","name":"ä¹å·å…¬å¸-WD","tags":"å‡ºå£ ä¸¤è½®è½¦","profit":20,"lowPE":20,"highPE":27,"revenue":215,"lowPS":1.8,"highPS":2.4,"logs":[{"date":"2025/11/20 20:56:49","content":"å±æ€§:â†’å‡ºå£ ä¸¤è½®è½¦","note":""},{"date":"2025/11/20 11:33:24","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002472.SZ","name":"åŒç¯ä¼ åŠ¨","tags":"æ±½è½¦é›¶éƒ¨ä»¶ æœºå™¨äºº","profit":12.5,"lowPE":24,"highPE":35,"revenue":100,"lowPS":2.5,"highPS":4.4,"logs":[{"date":"2025/11/20 20:58:56","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶ æœºå™¨äºº","note":""},{"date":"2025/11/20 11:34:20","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688208.SH","name":"é“é€šç§‘æŠ€","tags":"å‡ºå£ å……ç”µæ¡©","profit":9,"lowPE":20,"highPE":35,"revenue":50,"lowPS":4.77,"highPS":6,"logs":[{"date":"2025/11/20 20:56:25","content":"å±æ€§:â†’å‡ºå£ å……ç”µæ¡©","note":""},{"date":"2025/11/20 11:35:28","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603298.SH","name":"æ­å‰é›†å›¢","tags":"å‡ºå£ æœºå™¨äºº","profit":22.5,"lowPE":15,"highPE":20,"revenue":180,"lowPS":1.4,"highPS":2,"logs":[{"date":"2025/11/20 20:58:35","content":"å±æ€§:â†’å‡ºå£ æœºå™¨äºº","note":""},{"date":"2025/11/20 11:36:22","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300777.SZ","name":"ä¸­ç®€ç§‘æŠ€","profit":4.5,"lowPE":25,"highPE":45,"revenue":10,"lowPS":12,"highPS":18,"logs":[{"date":"2025/11/20 11:37:31","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"601689.SH","name":"æ‹“æ™®é›†å›¢","tags":"æ±½è½¦é›¶éƒ¨ä»¶ æœºå™¨äºº","profit":0,"lowPE":0,"highPE":0,"revenue":300,"lowPS":3.5,"highPS":4.7,"logs":[{"date":"2025/11/20 21:12:02","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶ æœºå™¨äºº","note":""},{"date":"2025/11/20 12:22:23","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688169.SH","name":"çŸ³å¤´ç§‘æŠ€","tags":"å‡ºå£ æ‰«åœ°æœº","profit":0,"lowPE":0,"highPE":0,"revenue":180,"lowPS":2.2,"highPS":3,"logs":[{"date":"2025/11/20 21:12:23","content":"å±æ€§:â†’å‡ºå£ æ‰«åœ°æœº","note":""},{"date":"2025/11/20 14:00:12","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"00388.HK","name":"é¦™æ¸¯äº¤æ˜“æ‰€","profit":175,"lowPE":28,"highPE":40,"revenue":280,"lowPS":15,"highPS":22,"logs":[{"date":"2025/11/20 14:01:57","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603345.SH","name":"å®‰äº•é£Ÿå“","tags":"æ¶ˆè´¹","profit":14,"lowPE":16,"highPE":25,"revenue":157,"lowPS":1.5,"highPS":2,"logs":[{"date":"2025/11/20 20:59:34","content":"å±æ€§:â†’æ¶ˆè´¹","note":""},{"date":"2025/11/20 14:03:54","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603486.SH","name":"ç§‘æ²ƒæ–¯","tags":"å‡ºå£ å®¶ç”µ æ‰«åœ°æœº","profit":21,"lowPE":20,"highPE":27,"revenue":225,"lowPS":1.6,"highPS":2.7,"logs":[{"date":"2025/11/20 21:03:09","content":"å±æ€§:â†’å‡ºå£ å®¶ç”µ æ‰«åœ°æœº","note":""},{"date":"2025/11/20 14:05:21","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300124.SZ","name":"æ±‡å·æŠ€æœ¯","tags":"å·¥æ§ è‡ªåŠ¨åŒ–","profit":56,"lowPE":27,"highPE":40,"revenue":0,"lowPS":0,"highPS":0,"logs":[{"date":"2025/11/20 21:04:24","content":"å±æ€§:â†’å·¥æ§ è‡ªåŠ¨åŒ–","note":""},{"date":"2025/11/20 14:06:03","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300627.SZ","name":"åæµ‹å¯¼èˆª","profit":7.6,"lowPE":30,"highPE":42,"revenue":41,"lowPS":5,"highPS":7,"logs":[{"date":"2025/11/20 14:06:59","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002920.SZ","name":"å¾·èµ›è¥¿å¨","tags":"æ±½è½¦é›¶éƒ¨ä»¶ æ™ºé©¾","profit":29,"lowPE":21,"highPE":30,"revenue":350,"lowPS":1.6,"highPS":2.4,"logs":[{"date":"2025/11/20 20:59:22","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶ æ™ºé©¾","note":""},{"date":"2025/11/20 14:08:36","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002202.SZ","name":"é‡‘é£ç§‘æŠ€","tags":"é£ç”µ","profit":41,"lowPE":15,"highPE":20,"revenue":800,"lowPS":0.6,"highPS":1,"logs":[{"date":"2025/11/20 21:00:03","content":"å±æ€§:â†’é£ç”µ","note":""},{"date":"2025/11/20 14:09:37","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002938.SZ","name":"é¹é¼æ§è‚¡","tags":"æœé“¾","profit":44,"lowPE":15,"highPE":30,"revenue":410,"lowPS":1.6,"highPS":3.2,"logs":[{"date":"2025/11/20 21:00:17","content":"å±æ€§:â†’æœé“¾","note":""},{"date":"2025/11/20 14:10:43","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002138.SZ","name":"é¡ºç»œç”µå­","tags":"å…ƒä»¶","profit":11.2,"lowPE":24,"highPE":29,"revenue":73,"lowPS":3.5,"highPS":5,"logs":[{"date":"2025/11/20 21:05:24","content":"å±æ€§:â†’å…ƒä»¶","note":""},{"date":"2025/11/20 14:11:47","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002475.SZ","name":"ç«‹è®¯ç²¾å¯†","tags":"æœé“¾","profit":167,"lowPE":20,"highPE":30,"revenue":3300,"lowPS":1.1,"highPS":1.6,"logs":[{"date":"2025/11/20 21:01:17","content":"å±æ€§:â†’æœé“¾","note":""},{"date":"2025/11/20 14:12:53","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002126.SZ","name":"é“¶è½®è‚¡ä»½","tags":"æ±½è½¦é›¶éƒ¨ä»¶ æœºå™¨äºº æ¶²å†·","profit":9.5,"lowPE":24,"highPE":35,"revenue":150,"lowPS":1.4,"highPS":2.2,"logs":[{"date":"2025/11/20 21:02:10","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶ æœºå™¨äºº æ¶²å†·","note":""},{"date":"2025/11/20 14:14:16","content":"é¦–æ¬¡åˆ›å»º","note":"Q3åä¸‹è°ƒ25å¹´ä¸šç»©æŒ‡å¼•ï¼Œ10.5ä¸‹è°ƒè‡³9.5"}]},{"code":"300433.SZ","name":"è“æ€ç§‘æŠ€","tags":"æœé“¾","profit":45,"lowPE":27,"highPE":37,"revenue":850,"lowPS":1.6,"highPS":2.1,"logs":[{"date":"2025/11/20 21:04:11","content":"å±æ€§:â†’æœé“¾","note":""},{"date":"2025/11/20 14:15:59","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"000858.SZ","name":"äº”ç²®æ¶²","tags":"æ¶ˆè´¹ ç™½é…’","profit":320,"lowPE":14,"highPE":18,"revenue":910,"lowPS":5,"highPS":6.5,"logs":[{"date":"2025/11/20 21:01:27","content":"å±æ€§:â†’æ¶ˆè´¹ ç™½é…’","note":""},{"date":"2025/11/20 14:18:25","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"000425.SZ","name":"å¾å·¥æœºæ¢°","tags":"å·¥ç¨‹æœºæ¢° å‡ºå£","profit":80,"lowPE":12,"highPE":20,"revenue":1000,"lowPS":0.93,"highPS":1.5,"logs":[{"date":"2025/11/20 20:59:46","content":"å±æ€§:â†’å·¥ç¨‹æœºæ¢° å‡ºå£","note":""},{"date":"2025/11/20 14:19:19","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688362.SH","name":"ç”¬çŸ½ç”µå­","tags":"åŠå¯¼ä½“ é«˜ç«¯å°æµ‹","profit":1.9,"lowPE":60,"highPE":120,"revenue":45,"lowPS":2.7,"highPS":3.6,"logs":[{"date":"2025/11/20 17:45:44","content":"å±æ€§:â†’åŠå¯¼ä½“ é«˜ç«¯å°æµ‹","note":""},{"date":"2025/11/20 14:20:22","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603501.SH","name":"è±ªå¨é›†å›¢","tags":"åŠå¯¼ä½“ æ¶ˆè´¹ç”µå­","profit":44,"lowPE":32,"highPE":45,"revenue":305,"lowPS":5,"highPS":6,"logs":[{"date":"2025/11/20 20:57:36","content":"å±æ€§:â†’åŠå¯¼ä½“ æ¶ˆè´¹ç”µå­","note":""},{"date":"2025/11/20 14:21:47","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"000333.SZ","name":"ç¾çš„é›†å›¢","tags":"æ¶ˆè´¹ å®¶ç”µ çº¢åˆ©","profit":490,"lowPE":12,"highPE":15,"revenue":4800,"lowPS":1.25,"highPS":1.5,"logs":[{"date":"2025/11/20 21:01:52","content":"å±æ€§:â†’æ¶ˆè´¹ å®¶ç”µ çº¢åˆ©","note":""},{"date":"2025/11/20 14:23:48","content":"PE:0-15â†’12-15","note":""},{"date":"2025/11/20 14:23:32","content":"å‡€åˆ©:0â†’490; PE:0-0â†’0-15","note":""},{"date":"2025/11/20 14:22:57","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"601799.SH","name":"æ˜Ÿå®‡è‚¡ä»½","tags":"æ±½è½¦é›¶éƒ¨ä»¶","profit":16.5,"lowPE":20,"highPE":25,"revenue":160,"lowPS":2,"highPS":2.7,"logs":[{"date":"2025/11/20 21:04:34","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶","note":""},{"date":"2025/11/20 14:24:54","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603129.SH","name":"æ˜¥é£åŠ¨åŠ›","tags":"å‡ºå£ æ‘©æ‰˜è½¦","profit":18.6,"lowPE":19,"highPE":25,"revenue":205,"lowPS":1.6,"highPS":2.2,"logs":[{"date":"2025/11/20 21:03:23","content":"å±æ€§:â†’å‡ºå£ æ‘©æ‰˜è½¦","note":""},{"date":"2025/11/20 14:25:56","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688111.SH","name":"é‡‘å±±åŠå…¬","tags":"AI è½¯ä»¶","profit":17,"lowPE":65,"highPE":100,"revenue":60,"lowPS":20,"highPS":30,"logs":[{"date":"2025/11/20 21:03:50","content":"å±æ€§:â†’AI è½¯ä»¶","note":""},{"date":"2025/11/20 14:27:25","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"605499.SH","name":"ä¸œé¹é¥®æ–™","tags":"æ¶ˆè´¹","profit":45,"lowPE":30,"highPE":36,"revenue":215,"lowPS":7,"highPS":8,"logs":[{"date":"2025/11/20 21:02:21","content":"å±æ€§:â†’æ¶ˆè´¹","note":""},{"date":"2025/11/20 14:30:19","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"600031.SH","name":"ä¸‰ä¸€é‡å·¥","tags":"å·¥ç¨‹æœºæ¢° å‡ºå£","profit":90,"lowPE":19,"highPE":27,"revenue":903,"lowPS":1.8,"highPS":2.5,"logs":[{"date":"2025/11/20 21:00:29","content":"å±æ€§:â†’å·¥ç¨‹æœºæ¢° å‡ºå£","note":""},{"date":"2025/11/20 14:31:19","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"601127.SH","name":"èµ›åŠ›æ–¯","tags":"æ±½è½¦ åä¸º","profit":100,"lowPE":16,"highPE":23,"revenue":1800,"lowPS":1.2,"highPS":1.5,"logs":[{"date":"2025/11/20 21:06:44","content":"å±æ€§:â†’æ±½è½¦ åä¸º","note":""},{"date":"2025/11/20 14:32:58","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002444.SZ","name":"å·¨æ˜Ÿç§‘æŠ€","tags":"å‡ºå£","profit":24,"lowPE":13.5,"highPE":18,"revenue":150,"lowPS":2,"highPS":2.8,"logs":[{"date":"2025/11/20 21:04:01","content":"å±æ€§:â†’å‡ºå£","note":""},{"date":"2025/11/20 14:33:53","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603005.SH","name":"æ™¶æ–¹ç§‘æŠ€","tags":"åŠå¯¼ä½“","profit":3.9,"lowPE":45,"highPE":90,"revenue":15,"lowPS":11,"highPS":14,"logs":[{"date":"2025/11/20 17:37:30","content":"å±æ€§:â†’åŠå¯¼ä½“","note":""},{"date":"2025/11/20 14:35:02","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603766.SH","name":"éš†é‘«é€šç”¨","tags":"å‡ºå£ æ‘©æ‰˜è½¦","profit":18,"lowPE":13.3,"highPE":18,"revenue":195,"lowPS":1.25,"highPS":1.5,"logs":[{"date":"2025/11/20 21:02:36","content":"å±æ€§:â†’å‡ºå£ æ‘©æ‰˜è½¦","note":""},{"date":"2025/11/20 14:36:31","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"600885.SH","name":"å®å‘è‚¡ä»½","tags":"å…ƒä»¶ ç»§ç”µå™¨","profit":19,"lowPE":20,"highPE":27,"revenue":163,"lowPS":2.5,"highPS":3,"logs":[{"date":"2025/11/20 21:05:12","content":"å±æ€§:â†’å…ƒä»¶ ç»§ç”µå™¨","note":""},{"date":"2025/11/20 14:37:42","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"600276.SH","name":"æ’ç‘åŒ»è¯","tags":"åŒ»è¯","profit":90,"lowPE":45,"highPE":63,"revenue":340,"lowPS":10,"highPS":14,"logs":[{"date":"2025/11/20 20:56:13","content":"å±æ€§:â†’åŒ»è¯","note":""},{"date":"2025/11/20 14:38:42","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"605117.SH","name":"å¾·ä¸šè‚¡ä»½","tags":"å‡ºå£ å‚¨èƒ½","profit":34,"lowPE":13,"highPE":25,"revenue":0,"lowPS":0,"highPS":0,"logs":[{"date":"2025/11/20 21:03:36","content":"å±æ€§:â†’å‡ºå£ å‚¨èƒ½","note":""},{"date":"2025/11/20 14:39:30","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"000651.SZ","name":"æ ¼åŠ›ç”µå™¨","tags":"æ¶ˆè´¹ å®¶ç”µ","profit":330,"lowPE":7,"highPE":8.3,"revenue":2000,"lowPS":1,"highPS":1.3,"logs":[{"date":"2025/11/20 21:02:48","content":"å±æ€§:â†’æ¶ˆè´¹ å®¶ç”µ","note":""},{"date":"2025/11/20 14:40:33","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002594.SZ","name":"æ¯”äºšè¿ª","tags":"æ±½è½¦","profit":350,"lowPE":17.5,"highPE":25,"revenue":8200,"lowPS":1,"highPS":1.2,"logs":[{"date":"2025/11/20 21:07:10","content":"å±æ€§:â†’æ±½è½¦","note":""},{"date":"2025/11/20 14:41:50","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"600519.SH","name":"è´µå·èŒ…å°","tags":"æ¶ˆè´¹ ç™½é…’","profit":940,"lowPE":19,"highPE":22,"revenue":1900,"lowPS":10,"highPS":12.5,"logs":[{"date":"2025/11/20 21:06:06","content":"å±æ€§:â†’æ¶ˆè´¹ ç™½é…’","note":""},{"date":"2025/11/20 14:42:50","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002050.SZ","name":"ä¸‰èŠ±æ™ºæ§","tags":"æ±½è½¦é›¶éƒ¨ä»¶ æœºå™¨äºº","profit":0,"lowPE":0,"highPE":0,"revenue":330,"lowPS":3,"highPS":6,"logs":[{"date":"2025/11/20 21:12:40","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶ æœºå™¨äºº","note":""},{"date":"2025/11/20 14:44:51","content":"å‡€åˆ©:300â†’0; PE:3.5-4.66â†’0-0","note":""},{"date":"2025/11/20 14:44:00","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"600114.SH","name":"ä¸œç¦è‚¡ä»½","tags":"æ¶ˆè´¹ç”µå­","profit":5.2,"lowPE":22,"highPE":38,"revenue":61,"lowPS":2,"highPS":3,"logs":[{"date":"2025/11/20 21:04:47","content":"å±æ€§:â†’æ¶ˆè´¹ç”µå­","note":""},{"date":"2025/11/20 14:45:57","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"600584.SH","name":"é•¿ç”µç§‘æŠ€","tags":"åŠå¯¼ä½“ å°æµ‹","profit":18,"lowPE":28,"highPE":40,"revenue":390,"lowPS":1.4,"highPS":2.2,"logs":[{"date":"2025/11/20 21:06:18","content":"å±æ€§:â†’åŠå¯¼ä½“ å°æµ‹","note":""},{"date":"2025/11/20 14:46:52","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688981.SH","name":"ä¸­èŠ¯å›½é™…","tags":"åŠå¯¼ä½“","profit":0,"lowPE":0,"highPE":0,"revenue":680,"lowPS":10,"highPS":15,"logs":[{"date":"2025/11/20 21:12:50","content":"å±æ€§:â†’åŠå¯¼ä½“","note":""},{"date":"2025/11/20 14:49:49","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"000400.SZ","name":"è®¸ç»§ç”µæ°”","tags":"ç”µåŠ›è®¾å¤‡","profit":13.5,"lowPE":15,"highPE":25,"revenue":170,"lowPS":1.1,"highPS":1.75,"logs":[{"date":"2025/11/20 21:01:06","content":"å±æ€§:â†’ç”µåŠ›è®¾å¤‡","note":""},{"date":"2025/11/20 14:50:52","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002847.SZ","name":"ç›æ´¥é“ºå­","tags":"æ¶ˆè´¹","profit":8,"lowPE":16,"highPE":30,"revenue":63.5,"lowPS":2,"highPS":3.5,"logs":[{"date":"2025/11/20 21:04:58","content":"å±æ€§:â†’æ¶ˆè´¹","note":""},{"date":"2025/11/20 14:52:30","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688676.SH","name":"é‡‘ç›˜ç§‘æŠ€","tags":"ç”µå™¨è®¾å¤‡ å‡ºå£","profit":7.3,"lowPE":25,"highPE":50,"revenue":88,"lowPS":2.2,"highPS":4.5,"logs":[{"date":"2025/11/20 21:07:00","content":"å±æ€§:â†’ç”µå™¨è®¾å¤‡ å‡ºå£","note":""},{"date":"2025/11/20 14:54:11","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603997.SH","name":"ç»§å³°è‚¡ä»½","tags":"æ±½è½¦é›¶éƒ¨ä»¶","profit":0,"lowPE":0,"highPE":0,"revenue":245,"lowPS":0.55,"highPS":0.72,"logs":[{"date":"2025/11/20 21:13:01","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶","note":""},{"date":"2025/11/20 14:55:15","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002595.SZ","name":"è±ªè¿ˆç§‘æŠ€","tags":"æ±½è½¦é›¶éƒ¨ä»¶","profit":25,"lowPE":18,"highPE":22,"revenue":110,"lowPS":4,"highPS":5,"logs":[{"date":"2025/11/20 21:07:24","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶","note":""},{"date":"2025/11/20 14:55:54","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"00700.HK","name":"è…¾è®¯æ§è‚¡","tags":"äº’è”ç½‘","profit":2400,"lowPE":18,"highPE":25,"revenue":8200,"lowPS":5.5,"highPS":7,"logs":[{"date":"2025/11/20 21:06:30","content":"å±æ€§:â†’äº’è”ç½‘","note":""},{"date":"2025/11/20 14:56:36","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"301345.SZ","name":"æ¶›æ¶›è½¦ä¸š","tags":"å‡ºå£","profit":7.5,"lowPE":18,"highPE":30,"revenue":40,"lowPS":2.5,"highPS":4.5,"logs":[{"date":"2025/11/20 21:07:34","content":"å±æ€§:â†’å‡ºå£","note":""},{"date":"2025/11/20 14:57:19","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688518.SH","name":"è”èµ¢æ¿€å…‰","tags":"å…‰ä¼è®¾å¤‡","profit":3,"lowPE":15,"highPE":25,"revenue":34,"lowPS":1.3,"highPS":2.6,"logs":[{"date":"2025/11/20 21:09:48","content":"å±æ€§:â†’å…‰ä¼è®¾å¤‡","note":""},{"date":"2025/11/20 14:58:20","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300476.SZ","name":"èƒœå®ç§‘æŠ€","tags":"AI","profit":0,"lowPE":0,"highPE":0,"revenue":300,"lowPS":4,"highPS":8,"logs":[{"date":"2025/11/20 21:13:12","content":"å±æ€§:â†’AI","note":""},{"date":"2025/11/20 14:59:35","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"301656.SZ","name":"è”åˆåŠ¨åŠ›","tags":"æ±½è½¦é›¶éƒ¨ä»¶","profit":0,"lowPE":0,"highPE":0,"revenue":215,"lowPS":1.5,"highPS":3,"logs":[{"date":"2025/11/20 21:13:22","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶","note":""},{"date":"2025/11/20 15:00:10","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688305.SH","name":"ç§‘å¾·æ•°æ§","tags":"å›½äº§æ›¿ä»£ æ•°æ§æœºåºŠ","profit":1.4,"lowPE":36,"highPE":55,"revenue":7,"lowPS":8.5,"highPS":12,"logs":[{"date":"2025/11/20 21:08:27","content":"å±æ€§:â†’å›½äº§æ›¿ä»£ æ•°æ§æœºåºŠ","note":""},{"date":"2025/11/20 15:01:04","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300308.SZ","name":"ä¸­é™…æ—­åˆ›","tags":"AI å…‰æ¨¡å—","profit":105,"lowPE":30,"highPE":50,"revenue":380,"lowPS":6,"highPS":10,"logs":[{"date":"2025/11/20 21:08:40","content":"å±æ€§:â†’AI å…‰æ¨¡å—","note":""},{"date":"2025/11/20 15:01:50","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688411.SH","name":"æµ·åšæ€åˆ›","tags":"å‚¨èƒ½","profit":25,"lowPE":20,"highPE":30,"revenue":360,"lowPS":1,"highPS":1.5,"logs":[{"date":"2025/11/20 20:58:16","content":"å±æ€§:â†’å‚¨èƒ½","note":""},{"date":"2025/11/20 15:06:44","content":"å‡€åˆ©:35â†’25","note":""},{"date":"2025/11/20 15:05:34","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300750.SZ","name":"å®å¾·æ—¶ä»£","tags":"ç”µæ± ","profit":680,"lowPE":18,"highPE":25,"revenue":0,"lowPS":0,"highPS":0,"logs":[{"date":"2025/11/20 21:08:08","content":"å±æ€§:â†’ç”µæ± ","note":""},{"date":"2025/11/20 15:07:47","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002371.SZ","name":"åŒ—æ–¹ååˆ›","tags":"åŠå¯¼ä½“","profit":0,"lowPE":0,"highPE":0,"revenue":390,"lowPS":5.5,"highPS":7.5,"logs":[{"date":"2025/11/20 21:13:31","content":"å±æ€§:â†’åŠå¯¼ä½“","note":""},{"date":"2025/11/20 15:08:22","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688361.SH","name":"ä¸­ç§‘é£æµ‹","tags":"åŠå¯¼ä½“","profit":0,"lowPE":0,"highPE":0,"revenue":21,"lowPS":12.5,"highPS":20,"logs":[{"date":"2025/11/20 21:13:43","content":"å±æ€§:â†’åŠå¯¼ä½“","note":""},{"date":"2025/11/20 15:09:34","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002600.SZ","name":"é¢†ç›Šæ™ºé€ ","tags":"æœé“¾","profit":25,"lowPE":25,"highPE":37,"revenue":500,"lowPS":1.3,"highPS":1.8,"logs":[{"date":"2025/11/20 21:08:53","content":"å±æ€§:â†’æœé“¾","note":""},{"date":"2025/11/20 15:12:02","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"DDOG","name":"Datadog Inc-A","tags":"ç¾è‚¡ è½¯ä»¶","profit":0,"lowPE":0,"highPE":0,"revenue":34,"lowPS":13.5,"highPS":17,"logs":[{"date":"2025/11/20 21:13:54","content":"å±æ€§:â†’ç¾è‚¡ è½¯ä»¶","note":""},{"date":"2025/11/20 15:12:50","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603179.SH","name":"æ–°æ³‰è‚¡ä»½","tags":"æ±½è½¦é›¶éƒ¨ä»¶","profit":13.2,"lowPE":16,"highPE":22,"revenue":170,"lowPS":1.2,"highPS":1.8,"logs":[{"date":"2025/11/20 21:09:17","content":"å±æ€§:â†’æ±½è½¦é›¶éƒ¨ä»¶","note":""},{"date":"2025/11/20 15:13:56","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"300274.SZ","name":"é˜³å…‰ç”µæº","tags":"å‚¨èƒ½","profit":145,"lowPE":13,"highPE":22,"revenue":970,"lowPS":1.75,"highPS":3.4,"logs":[{"date":"2025/11/20 21:10:00","content":"å±æ€§:â†’å‚¨èƒ½","note":""},{"date":"2025/11/20 15:15:04","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688072.SH","name":"æ‹“è†ç§‘æŠ€","tags":"åŠå¯¼ä½“","profit":10,"lowPE":43,"highPE":70,"revenue":57,"lowPS":8,"highPS":12,"logs":[{"date":"2025/11/20 21:10:28","content":"å±æ€§:â†’åŠå¯¼ä½“","note":""},{"date":"2025/11/20 15:16:19","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"603986.SH","name":"å…†æ˜“åˆ›æ–°","tags":"åŠå¯¼ä½“ å­˜å‚¨","profit":15,"lowPE":50,"highPE":80,"revenue":95,"lowPS":8,"highPS":11,"logs":[{"date":"2025/11/20 21:09:32","content":"å±æ€§:â†’åŠå¯¼ä½“ å­˜å‚¨","note":""},{"date":"2025/11/20 15:17:12","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"688698.SH","name":"ä¼Ÿåˆ›ç”µæ°”","tags":"å·¥ä¸šæ§åˆ¶ æœºå™¨äºº","profit":2.8,"lowPE":25,"highPE":35,"revenue":20,"lowPS":4,"highPS":6,"logs":[{"date":"2025/11/20 21:10:56","content":"å±æ€§:â†’å·¥ä¸šæ§åˆ¶ æœºå™¨äºº","note":""},{"date":"2025/11/20 15:20:29","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002028.SZ","name":"æ€æºç”µæ°”","tags":"ç”µåŠ›è®¾å¤‡ å‡ºå£","profit":30,"lowPE":23,"highPE":30,"revenue":195,"lowPS":3.1,"highPS":4,"logs":[{"date":"2025/11/20 21:10:14","content":"å±æ€§:â†’ç”µåŠ›è®¾å¤‡ å‡ºå£","note":""},{"date":"2025/11/20 15:22:24","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"601138.SH","name":"å·¥ä¸šå¯Œè”","tags":"æœé“¾ AI","profit":335,"lowPE":15,"highPE":25,"revenue":9200,"lowPS":0.6,"highPS":1,"logs":[{"date":"2025/11/20 21:10:41","content":"å±æ€§:â†’æœé“¾ AI","note":""},{"date":"2025/11/20 15:23:21","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"002837.SZ","name":"è‹±ç»´å…‹","tags":"æ¶²å†·","profit":6.3,"lowPE":38,"highPE":65,"revenue":65,"lowPS":4,"highPS":7,"logs":[{"date":"2025/11/20 21:11:17","content":"å±æ€§:â†’æ¶²å†·","note":""},{"date":"2025/11/20 15:23:58","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"001309.SZ","name":"å¾·æ˜åˆ©","tags":"å­˜å‚¨ é˜¿é‡Œæ¦‚å¿µ","profit":3.6,"lowPE":35,"highPE":60,"revenue":85,"lowPS":2.54,"highPS":3.2,"logs":[{"date":"2025/11/20 21:11:34","content":"å±æ€§:â†’å­˜å‚¨ é˜¿é‡Œæ¦‚å¿µ","note":""},{"date":"2025/11/20 15:24:43","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]},{"code":"NVDA","name":"è‹±ä¼Ÿè¾¾","tags":"AI","profit":1700,"lowPE":35,"highPE":70,"revenue":3000,"lowPS":20,"highPS":40,"logs":[{"date":"2025/11/20 17:12:22","content":"å±æ€§:â†’AI","note":""},{"date":"2025/11/20 15:30:06","content":"å‡€åˆ©:0â†’1700; PE:0-0â†’35-70","note":""},{"date":"2025/11/20 15:28:12","content":"é¦–æ¬¡åˆ›å»º","note":"åˆå§‹åŒ–ä¼°å€¼æ¨¡å‹"}]}];

        let stocks = JSON.parse(localStorage.getItem('valuationStocks'));
        if (!stocks || stocks.length === 0) {
            stocks = PRELOADED_DATA;
            localStorage.setItem('valuationStocks', JSON.stringify(stocks));
        }

        let viewSettings = JSON.parse(localStorage.getItem('viewSettings')) || { showCode: true, showTags: true };
        let intervalId = null;
        let sortState = { key: 'pe_up', dir: 'desc' };
        let isPanelOpen = false;
        let pendingDeleteCode = null;
        let cachedMarketData = {};
        let selectedCodes = new Set();
        let columnFilters = {}; 
        let onlySelectedMode = false;
        let currentVisibleStocks = [];

        // åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
        updateViewButtons();

        function getSecid(code) {
            if (code.endsWith('.SH')) return `1.${code.replace('.SH','')}`;
            if (code.endsWith('.SZ')) return `0.${code.replace('.SZ','')}`;
            if (code.endsWith('.HK')) return `116.${code.replace('.HK','')}`;
            return `105.${code}`;
        }

        async function updateTable() {
            const container = document.getElementById('result');
            const statusMsg = document.getElementById('status-msg');
            
            if (stocks.length === 0) {
                container.innerHTML = '<div style="padding:40px;text-align:center;color:#999;border:2px dashed #eee;border-radius:10px;">ğŸ“­ åˆ—è¡¨ä¸ºç©ºï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹ "å½•å…¥/ç®¡ç†" æ·»åŠ è‚¡ç¥¨</div>';
                statusMsg.innerText = ""; return;
            }

            const secids = stocks.map(s => getSecid(s.code)).join(',');
            const url = `https://push2.eastmoney.com/api/qt/ulist.np/get?secids=${secids}&fields=f12,f14,f2,f3,f18,f20&invt=2&fltt=2&_=${Date.now()}`;

            try {
                const res = await fetch(url);
                const json = await res.json();
                if (json?.data?.diff) {
                    const list = Array.isArray(json.data.diff) ? json.data.diff : Object.values(json.data.diff);
                    list.forEach(item => { cachedMarketData[item.f12] = item; });
                    statusMsg.innerHTML = `â— æ•°æ®å·²æ›´æ–° ${new Date().toLocaleTimeString()}`;
                    statusMsg.style.color = "#007bff";
                }
            } catch (e) { statusMsg.innerHTML = `<span style="color:orange">âš ï¸ ç½‘ç»œæ³¢åŠ¨ï¼Œæ˜¾ç¤ºç¼“å­˜</span>`; }

            const data = stocks.map(s => {
                const rawCode = s.code.split('.')[0];
                const mItem = cachedMarketData[rawCode];
                let market = { cap: 0, chg: 0, valid: false };
                if (mItem) {
                    let p = parseFloat(mItem.f2); 
                    let last = parseFloat(mItem.f18);
                    let mCap = parseFloat(mItem.f20);
                    let chgPct = parseFloat(mItem.f3);
                    let validPrice = (p > 0) ? p : last;
                    let validCap = (mCap > 0) ? mCap : 0;
                    market.cap = validCap / 100000000; 
                    if (!isNaN(chgPct)) market.chg = chgPct.toFixed(2); else market.chg = "0.00";
                    market.valid = true;
                }
                let peRes = { down: '-', up: '-' };
                let psRes = { down: '-', up: '-' };
                if (market.valid && market.cap > 0) {
                    if (s.profit && s.lowPE) {
                        peRes.down = ((s.profit * s.lowPE / market.cap - 1) * 100).toFixed(2);
                        peRes.up = ((s.profit * s.highPE - market.cap) / market.cap * 100).toFixed(2);
                    }
                    if (s.revenue && s.lowPS) {
                        psRes.down = ((s.revenue * s.lowPS / market.cap - 1) * 100).toFixed(2);
                        psRes.up = ((s.revenue * s.highPS - market.cap) / market.cap * 100).toFixed(2);
                    }
                }
                return { ...s, ...market, peRes, psRes };
            });

            renderTable(data);
            updateCompareBtn();
        }

        function renderTable(data) {
            const container = document.getElementById('result');
            
            let filteredData = data.filter(item => {
                if (onlySelectedMode && !selectedCodes.has(item.code)) return false;
                const searchKey = document.getElementById('findInput').value.trim().toUpperCase();
                if (searchKey && !item.code.includes(searchKey) && !item.name.includes(searchKey)) return false;

                for (let colKey in columnFilters) {
                    const rule = columnFilters[colKey];
                    if (!rule) continue;
                    if (rule.type === 'text') {
                        const cellVal = (item[colKey] || "").toLowerCase();
                        if (!cellVal.includes(rule.val.toLowerCase())) return false;
                    } else {
                        let val = -999999;
                        if (colKey === 'pe_down') val = parseFloat(item.peRes.down);
                        else if (colKey === 'pe_up') val = parseFloat(item.peRes.up);
                        else if (colKey === 'ps_down') val = parseFloat(item.psRes.down);
                        else if (colKey === 'ps_up') val = parseFloat(item.psRes.up);
                        if (isNaN(val)) return false;
                        const limit = rule.val;
                        switch(rule.op) {
                            case '>': if (!(val > limit)) return false; break;
                            case '<': if (!(val < limit)) return false; break;
                            case '>=': if (!(val >= limit)) return false; break;
                            case '<=': if (!(val <= limit)) return false; break;
                            case '=': if (Math.abs(val - limit) > 0.1) return false; break;
                        }
                    }
                }
                return true;
            });
            
            currentVisibleStocks = filteredData;

            if (sortState.key) {
                filteredData.sort((a, b) => {
                    const getVal = (obj, k) => {
                        if(k=='chg') return parseFloat(obj.chg);
                        if(k.includes('pe')) return parseFloat(obj.peRes[k.split('_')[1]]) || -9999;
                        if(k.includes('ps')) return parseFloat(obj.psRes[k.split('_')[1]]) || -9999;
                        return 0;
                    };
                    return sortState.dir === 'desc' ? getVal(b, sortState.key) - getVal(a, sortState.key) : getVal(a, sortState.key) - getVal(b, sortState.key);
                });
            }

            const getFilterIcon = (key) => {
                const isActive = columnFilters[key] != null;
                const iconClass = isActive ? 'filter-icon filter-active' : 'filter-icon';
                const symbol = isActive ? 'â–¼' : 'â–½';
                return `<span class="${iconClass}" onclick="event.stopPropagation(); openFilterMenu('${key}', event)">${symbol}</span>`;
            };

            const styleCode = viewSettings.showCode ? '' : 'col-hidden';
            const styleTags = viewSettings.showTags ? '' : 'col-hidden';
            const isAllVisibleSelected = filteredData.length > 0 && filteredData.every(item => selectedCodes.has(item.code));

            let html = `
            <table>
                <thead>
                    <tr>
                        <th style="width:30px;">é€‰</th>
                        <th class="th-basic" colspan="${2 + (viewSettings.showCode?1:0) + (viewSettings.showTags?1:0)}">ğŸ“Š åŸºç¡€è¡Œæƒ…</th>
                        <th class="th-pe" colspan="4">ğŸ’° PE ä¼°å€¼æ¨¡å‹ (åˆ©æ¶¦)</th>
                        <th class="th-ps" colspan="4">ğŸš€ PS ä¼°å€¼æ¨¡å‹ (è¥æ”¶)</th>
                        <th class="th-basic">âš™ï¸ æ“ä½œ</th>
                    </tr>
                    <tr>
                        <th><input type="checkbox" id="header-checkbox" onclick="toggleSelectAll()" ${isAllVisibleSelected ? 'checked' : ''}></th>
                        <th>åç§°</th>
                        <th class="${styleCode}">ä»£ç </th>
                        <th class="${styleTags}" style="max-width:150px;">å±æ€§ ${getFilterIcon('tags')}</th>
                        <th onclick="setSort('chg')" class="sortable">æ¶¨è·Œ <span class="${getSortClass('chg')}">${getSortIcon('chg')}</span></th>
                        <th>å¸‚å€¼(äº¿)</th>
                        <th>é¢„æœŸå‡€åˆ©</th>
                        <th>åˆç†PE</th>
                        <th onclick="setSort('pe_down')" class="sortable">ä¸‹è¡Œ% ${getFilterIcon('pe_down')} <span class="${getSortClass('pe_down')}">${getSortIcon('pe_down')}</span></th>
                        <th onclick="setSort('pe_up')" class="sortable">ä¸Šè¡Œ% ${getFilterIcon('pe_up')} <span class="${getSortClass('pe_up')}">${getSortIcon('pe_up')}</span></th>
                        <th>é¢„æœŸè¥æ”¶</th>
                        <th>åˆç†PS</th>
                        <th onclick="setSort('ps_down')" class="sortable">ä¸‹è¡Œ% ${getFilterIcon('ps_down')} <span class="${getSortClass('ps_down')}">${getSortIcon('ps_down')}</span></th>
                        <th onclick="setSort('ps_up')" class="sortable">ä¸Šè¡Œ% ${getFilterIcon('ps_up')} <span class="${getSortClass('ps_up')}">${getSortIcon('ps_up')}</span></th>
                        <th>åŠŸèƒ½</th>
                    </tr>
                </thead>
                <tbody>
            `;

            if(filteredData.length === 0) {
                html += `<tr><td colspan="15" style="padding:30px;text-align:center;color:#999;">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨</td></tr>`;
            } else {
                filteredData.forEach(item => {
                    const fmtPct = (v) => {
                        if(v==='-') return '<span class="data-empty">-</span>';
                        const val = parseFloat(v);
                        const color = val >= 0 ? '#d32f2f' : '#2e7d32';
                        const weight = (val > 30) ? '800' : 'bold';
                        return `<span style="color:${color}; font-weight:${weight}">${v}%</span>`;
                    };

                    let tagsHtml = '';
                    if(item.tags) tagsHtml = item.tags.split(' ').map(t => t.trim()).filter(t=>t).map(t => `<span class="tag-badge">${t}</span>`).join('');

                    const rowId = 'row-' + item.code.replace(/\./g, '-');
                    const isChecked = selectedCodes.has(item.code) ? 'checked' : '';
                    const rowClass = isChecked ? 'row-selected' : '';

                    html += `
                        <tr id="${rowId}" class="${rowClass}">
                            <td><input type="checkbox" class="row-checkbox" data-code="${item.code}" ${isChecked} onclick="toggleSelectRow('${item.code}', this)"></td>
                            <td style="font-weight:600; color:#343a40;">${item.name}</td>
                            <td class="${styleCode}" style="color:#868e96; font-size:12px;">${item.code}</td>
                            <td class="${styleTags}" style="text-align:left;">${tagsHtml}</td>
                            <td style="font-weight:bold; color:${parseFloat(item.chg)>=0 ? '#e03131':'#099268'}">${item.chg}%</td>
                            <td style="font-family:monospace; font-size:13px;">${item.cap ? item.cap.toFixed(2) : '-'}</td>
                            <td>${item.profit || '<span class="data-empty">-</span>'}</td>
                            <td style="font-size:12px;">${item.lowPE||'-'}~${item.highPE||'-'}</td>
                            <td>${fmtPct(item.peRes.down)}</td>
                            <td>${fmtPct(item.peRes.up)}</td>
                            <td>${item.revenue || '<span class="data-empty">-</span>'}</td>
                            <td style="font-size:12px;">${item.lowPS||'-'}~${item.highPS||'-'}</td>
                            <td>${fmtPct(item.psRes.down)}</td>
                            <td>${fmtPct(item.psRes.up)}</td>
                            <td style="white-space:nowrap;">
                                <button class="btn-log" onclick="showLogs('${item.code}')" title="æ—¥å¿—">ğŸ“</button>
                                <button class="btn-edit" onclick="editStock('${item.code}')" title="ä¿®æ”¹">âœï¸</button>
                                <button class="btn-delete" onclick="openDeleteModal('${item.code}')" title="åˆ é™¤">âœ•</button>
                            </td>
                        </tr>
                    `;
                });
            }
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function toggleSelectRow(code, checkbox) { if (checkbox.checked) selectedCodes.add(code); else selectedCodes.delete(code); updateTable(); }
        
        function toggleSelectAll() {
            if (currentVisibleStocks.length === 0) return;
            const allSelected = currentVisibleStocks.every(item => selectedCodes.has(item.code));
            if (allSelected) currentVisibleStocks.forEach(item => selectedCodes.delete(item.code));
            else currentVisibleStocks.forEach(item => selectedCodes.add(item.code));
            updateTable();
        }

        function clearAllFilters() {
            columnFilters = {}; 
            document.getElementById('findInput').value = ''; 
            if (onlySelectedMode) toggleShowSelected(); 
            updateTable();
        }

        function toggleShowSelected() {
            onlySelectedMode = !onlySelectedMode;
            const btn = document.getElementById('btn-compare');
            if (onlySelectedMode) { btn.classList.add('active'); btn.innerText = "ğŸ”™ æ˜¾ç¤ºå…¨éƒ¨"; }
            else { btn.classList.remove('active'); updateCompareBtn(); }
            updateTable();
        }
        function updateCompareBtn() { if (!onlySelectedMode) document.getElementById('btn-compare').innerText = `ğŸ“Š åªçœ‹é€‰ä¸­ (${selectedCodes.size})`; }

        function toggleColumn(colType) {
            if(colType === 'code') viewSettings.showCode = !viewSettings.showCode;
            if(colType === 'tags') viewSettings.showTags = !viewSettings.showTags;
            localStorage.setItem('viewSettings', JSON.stringify(viewSettings));
            updateViewButtons(); updateTable();
        }
        function updateViewButtons() {
            const btnCode = document.getElementById('btn-toggle-code');
            const btnTags = document.getElementById('btn-toggle-tags');
            if(viewSettings.showCode) btnCode.classList.add('active'); else btnCode.classList.remove('active');
            if(viewSettings.showTags) btnTags.classList.add('active'); else btnTags.classList.remove('active');
        }

        function openFilterMenu(colKey, event) {
            const menu = document.getElementById('filter-menu');
            const input = document.getElementById('filter-val');
            const op = document.getElementById('filter-op');
            const numRow = document.getElementById('filter-row-numeric');
            const textRow = document.getElementById('filter-row-text');
            const title = document.getElementById('filter-title');
            const isText = colKey === 'tags';
            numRow.style.display = isText ? 'none' : 'flex';
            textRow.style.display = isText ? 'flex' : 'none';
            title.innerText = isText ? "ç­›é€‰åŒ…å«" : "æ•°å€¼ç­›é€‰";
            const rect = event.target.getBoundingClientRect();
            menu.style.top = (window.scrollY + rect.bottom + 5) + 'px';
            menu.style.left = Math.min(window.innerWidth - 230, (window.scrollX + rect.left - 100)) + 'px';
            menu.style.display = 'block';
            document.getElementById('filter-col-key').value = colKey;
            const existing = columnFilters[colKey];
            if (isText) {
                document.getElementById('filter-text-val').value = existing ? existing.val : "";
                document.getElementById('filter-text-val').focus();
            } else {
                if (existing) { op.value = existing.op; input.value = existing.val; } else { op.value = ">"; input.value = ""; }
                input.focus();
            }
            setTimeout(() => { document.addEventListener('click', closeFilterMenuOutside); }, 0);
        }
        function closeFilterMenuOutside(e) { const menu = document.getElementById('filter-menu'); if (!menu.contains(e.target)) { menu.style.display = 'none'; document.removeEventListener('click', closeFilterMenuOutside); } }
        function confirmFilter() {
            const colKey = document.getElementById('filter-col-key').value;
            const isText = colKey === 'tags';
            if (isText) {
                const val = document.getElementById('filter-text-val').value.trim();
                if (val === "") delete columnFilters[colKey]; else columnFilters[colKey] = { type: 'text', val: val };
            } else {
                const op = document.getElementById('filter-op').value;
                const valStr = document.getElementById('filter-val').value;
                if (valStr === "") delete columnFilters[colKey]; else columnFilters[colKey] = { type: 'num', op: op, val: parseFloat(valStr) };
            }
            document.getElementById('filter-menu').style.display = 'none'; document.removeEventListener('click', closeFilterMenuOutside); updateTable();
        }
        function clearCurrentFilter() { const colKey = document.getElementById('filter-col-key').value; delete columnFilters[colKey]; document.getElementById('filter-menu').style.display = 'none'; document.removeEventListener('click', closeFilterMenuOutside); updateTable(); }
        function getColName(key) { if(key=='pe_up') return 'PEä¸Šè¡Œ'; if(key=='pe_down') return 'PEä¸‹è¡Œ'; if(key=='ps_up') return 'PSä¸Šè¡Œ'; if(key=='ps_down') return 'PSä¸‹è¡Œ'; return key; }

        function findInList() { const k = document.getElementById('findInput').value.trim().toUpperCase(); if (!k) { updateTable(); return; } const t = stocks.find(s => s.code.includes(k) || s.name.includes(k)); if (t) { const r = document.getElementById('row-' + t.code.replace(/\./g, '-')); if (r) { r.scrollIntoView({ behavior: 'smooth', block: 'center' }); r.classList.remove('row-highlight'); void r.offsetWidth; r.classList.add('row-highlight'); } else alert("æœªæ˜¾ç¤º(è¢«ç­›é€‰éšè—)"); } else alert("æœªæ‰¾åˆ°"); }
        function saveStock() { const c = document.getElementById('inCode').value.trim(); const n = document.getElementById('inName').value.trim(); const nt = document.getElementById('inNote').value.trim(); const tags = document.getElementById('inTags').value.trim(); const p = parseFloat(document.getElementById('inProfit').value)||0; const lpe = parseFloat(document.getElementById('inLowPE').value)||0; const hpe = parseFloat(document.getElementById('inHighPE').value)||0; const rev = parseFloat(document.getElementById('inRevenue').value)||0; const lps = parseFloat(document.getElementById('inLowPS').value)||0; const hps = parseFloat(document.getElementById('inHighPS').value)||0; if (!c || !n) { alert("ä»£ç /åç§°å¿…å¡«"); return; } const now = new Date().toLocaleString('zh-CN', { hour12: false }); let ch = []; const sd = { code: c, name: n, tags, profit: p, lowPE: lpe, highPE: hpe, revenue: rev, lowPS: lps, highPS: hps, logs: [] }; const idx = stocks.findIndex(s => s.code === c); if (idx >= 0) { const old = stocks[idx]; sd.logs = old.logs || []; if(old.profit!==p) ch.push(`å‡€åˆ©:${old.profit}â†’${p}`); if((old.tags||"")!==tags) ch.push(`å±æ€§:${old.tags||""}â†’${tags}`); if (ch.length > 0 || nt) { sd.logs.unshift({ date: now, content: ch.join('; '), note: nt }); } stocks[idx] = sd; } else { newLog = { date: now, content: "é¦–æ¬¡åˆ›å»º", note: note || "åˆå§‹åŒ–" }; sd.logs.push(newLog); stocks.push(sd); } saveStorage(); clearInput(); updateTable(); }
        
        window.openDeleteModal = function(c) { pendingDeleteCode = c; document.getElementById('delete-msg').innerText=`ç¡®è®¤ä¸å†è·Ÿè¸ª ${c}?`; document.getElementById('delete-modal').style.display='flex'; };
        window.confirmDeleteAction = function() { if(pendingDeleteCode) { stocks=stocks.filter(s=>s.code!==pendingDeleteCode); selectedCodes.delete(pendingDeleteCode); saveStorage(); updateTable(); } closeDeleteModal(); };
        window.closeDeleteModal = function() { document.getElementById('delete-modal').style.display='none'; };
        window.exportData = function() { navigator.clipboard.writeText(JSON.stringify(stocks)).then(()=>alert("å·²å¤åˆ¶"), ()=>prompt("å¤åˆ¶:", JSON.stringify(stocks))); };
        window.importData = function() { document.getElementById('import-modal').style.display='flex'; };
        window.closeImportModal = function() { document.getElementById('import-modal').style.display='none'; };
        window.execImport = function() { try { const str = document.getElementById('import-area').value; const parsed = JSON.parse(str); if(Array.isArray(parsed)) { let ad=0,up=0; parsed.forEach(n => { const idx = stocks.findIndex(s => s.code === n.code); if(idx > -1) { stocks[idx] = { ...stocks[idx], ...n }; up++; } else { stocks.push(n); ad++; } }); saveStorage(); updateTable(); closeImportModal(); alert(`å®Œæˆ: æ–°å¢${ad}, æ›´æ–°${up}`); } else alert("æ ¼å¼é”™è¯¯"); } catch(e) { alert("è§£æå¤±è´¥"); } };
        
        function searchStockCode() { const name = document.getElementById('inName').value.trim(); if(!name) return; const btn = document.querySelector('.btn-search'); btn.innerText='...'; const sc = document.createElement('script'); window.handleSearch = function(d) { btn.innerText='ğŸ”'; if(d?.QuotationCodeTable?.Data?.length) { const r = d.QuotationCodeTable.Data[0]; let suf = r.MarketType=="1"?".SH":(r.MarketType=="2"?".SZ":(r.Code.length===5?".HK":"")); if(!suf && r.Code.length===6) suf = r.Code.startsWith('6')?".SH":".SZ"; document.getElementById('inCode').value = r.Code+suf; document.getElementById('inName').value = r.Name; } else { alert("æœªæ‰¾åˆ°"); } sc.remove(); }; sc.src = `https://searchapi.eastmoney.com/api/suggest/get?input=${encodeURIComponent(name)}&type=14&token=D43BF722C8E33BD5D50F639205545E43&cb=handleSearch`; document.body.appendChild(sc); }
        function toggleInputPanel() { const c=document.getElementById('input-container'); isPanelOpen=!isPanelOpen; c.style.display=isPanelOpen?'block':'none'; document.getElementById('toggle-btn').innerText=isPanelOpen?'ğŸ”¼ æ”¶èµ·':'â• å½•å…¥/ç®¡ç† (å±•å¼€)'; }
        function clearInput() { document.querySelectorAll('#input-panel input').forEach(i=>i.value=''); document.getElementById('editCode').value=''; document.getElementById('btn-save-text').innerText="ğŸ’¾ ä¿å­˜"; }
        function editStock(c) { toggleInputPanel(); isPanelOpen=true; document.getElementById('input-container').style.display='block'; const s=stocks.find(i=>i.code===c); if(!s)return; document.getElementById('inName').value=s.name; document.getElementById('inCode').value=s.code; document.getElementById('inTags').value=s.tags||''; document.getElementById('inProfit').value=s.profit||''; document.getElementById('inLowPE').value=s.lowPE||''; document.getElementById('inHighPE').value=s.highPE||''; document.getElementById('inRevenue').value=s.revenue||''; document.getElementById('inLowPS').value=s.lowPS||''; document.getElementById('inHighPS').value=s.highPS||''; document.getElementById('btn-save-text').innerText="ğŸ’¾ ç¡®è®¤ä¿®æ”¹"; }
        function showLogs(c) { const s=stocks.find(i=>i.code===c); if(!s)return; document.getElementById('modal-title').innerText=`${s.name} æ—¥å¿—`; document.getElementById('modal-body').innerHTML = s.logs?.map(l=>`<div class="log-entry"><div class="log-time">${l.date}</div><div>${l.content}</div></div>`).join('')||'æ— è®°å½•'; document.getElementById('log-modal').style.display='flex'; }
        function closeLogModal() { document.getElementById('log-modal').style.display='none'; }
        function startRealtime() { if(!intervalId) { updateTable(); intervalId=setInterval(updateTable, 5000); document.getElementById('status-msg').innerText="â— å®æ—¶ä¸­"; } }
        function stopRealtime() { clearInterval(intervalId); intervalId=null; document.getElementById('status-msg').innerText="â¸ æš‚åœ"; }
        function setSort(k) { if(sortState.key===k) sortState.dir=sortState.dir==='desc'?'asc':'desc'; else {sortState.key=k; sortState.dir='desc';} updateTable(); }
        function getSortIcon(k) { return sortState.key!==k?'â‡…':(sortState.dir==='desc'?'â¬‡':'â¬†'); }
        function getSortClass(k) { return sortState.key===k?'sort-icon sort-active':'sort-icon'; }
        function saveStorage() { localStorage.setItem('valuationStocks', JSON.stringify(stocks)); }
        
        window.onclick = function(e) { if(e.target.className==='modal') e.target.style.display='none'; }

        updateTable();
    </script>
</body>
</html>